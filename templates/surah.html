{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/surah.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
{% endblock %}

{% block banner_class %}surah-banner{% endblock %}

{% block banner_content %}
<div class="surah-banner2" data-surah-number="{{ surah.number }}">
    <h1 class="surah-title">{{ surah.surahNameArabic }}</h1>
    <img class="banner-image" src="{{ url_for('static', filename='images/quran-icon.png') }}" alt="Quran">
</div>
{% endblock %}

{% block content %}
<!-- Reading Progress Bar -->
<div class="reading-progress-container">
    <div class="reading-progress-bar" id="readingProgressBar"></div>
</div>

<!-- Navigation Menu -->
<div class="surah-nav">
    <div class="nav-container" data-active="reading">
        <button class="nav-button active" data-view="reading">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            Reading
        </button>
        <button class="nav-button" data-view="translation">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>
            Translation
        </button>
        <button class="nav-button" data-view="tafsir">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 4v16h2V4h-2M15 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h11V4z"/><path d="M8 12h3"/><path d="M8 16h3"/><path d="M8 8h3"/></svg>
            Tafsir
        </button>
        <button class="nav-button" data-view="audio">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6L8 10H4V14H8L12 18V6Z"></path><path d="M17 7C17 7 19 9 19 12C19 15 17 17 17 17"></path><path d="M15.5 10.5C15.5 10.5 16.5 11.5 16.5 12C16.5 12.5 15.5 13.5 15.5 13.5"></path></svg>
            Audio
        </button>
    </div>
</div>

<!-- Add this right after the Translation Selector div -->
<div class="qari-selector">
    <div class="current-qari">
        Recitation by <span id="currentQari">Mishary Rashid Alafasy</span>
    </div>
    <a class="change-qari" id="changeQari">(Change)</a>
</div>

<!-- Translation Selector -->
<div class="translation-selector" style="display: none;">
    <div class="current-translation">
        Translation by <span id="currentTranslator">Saheeh International</span>
    </div>
    <a class="change-translation" id="changeTranslation">(Change)</a>
</div>

<!-- Tafsir Selector -->
<div class="tafsir-selector" style="display: none;">
    <div class="current-tafsir">
        Tafsir by <span id="currentTafsir">Bayan-ul-Quran</span>
    </div>
    <a class="change-tafsir" id="changeTafsir">(Change)</a>
</div>

<!-- Audio Translation Selector -->
<div class="audio-translation-selector" style="display: none;">
    <div class="current-audio-translation">
        Audio Translation in <span id="currentAudioLanguage">English</span>
    </div>
    <a class="change-audio-translation" id="changeAudioTranslation">(Change)</a>
</div>

<!-- Translation Modal -->
<div class="modal-overlay" id="translationModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Select Translation</h3>
            <button class="close-modal" id="closeModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="translations-list" id="translationsList">
                <div class="loading">Loading translations...</div>
            </div>
        </div>
    </div>
</div>

<!-- Tafsir Modal -->
<div class="modal-overlay" id="tafsirModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Select Tafsir</h3>
            <button class="close-modal" id="closeTafsirModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="tafsir-list" id="tafsirList">
                <div class="loading">Loading tafsirs...</div>
            </div>
        </div>
    </div>
</div>

<!-- Add this right after the Translation Modal div -->
<div class="modal-overlay" id="qariModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Select Reciter</h3>
            <button class="close-modal" id="closeQariModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="qari-list" id="qariList">
                <div class="loading">Loading reciters...</div>
            </div>
        </div>
    </div>
</div>

<!-- Audio Translation Modal -->
<div class="modal-overlay" id="audioTranslationModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Select Audio Translation Language</h3>
            <button class="close-modal" id="closeAudioTranslationModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="audio-translations-list" id="audioTranslationsList">
                <div class="audio-translation-option" data-language="English">
                    <div class="audio-translation-info">
                        <div class="audio-translation-language">English</div>
                    </div>
                </div>
                <div class="audio-translation-option" data-language="Urdu">
                    <div class="audio-translation-info">
                        <div class="audio-translation-language">Urdu</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Audio Player -->
<div class="audio-player">
    <button class="play-button" id="playButton" aria-label="Play/Pause">
        <svg viewBox="0 0 24 24" id="playIcon">
            <path d="M8 5v14l11-7z"/>
        </svg>
        <svg viewBox="0 0 24 24" id="pauseIcon" style="display: none;">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
    </button>
    <div class="audio-progress" id="progressBar">
        <div class="progress-bar" id="progress"></div>
    </div>
    <div class="time-display" id="timeDisplay">0:00</div>
</div>
<audio id="audioElement" src="{{surah.audio_url }}"></audio>

<div class="surah-container">
    <div class="verses-container">
        {% for verse in surah.arabic1 %}
        <div class="verse" data-verse-number="{{ loop.index }}">
            <div class="arabic-text">{{ verse }}</div>
            <div class="verse-translation"></div>
            <div class="verse-tafsir"></div>
            <div class="verse-number">{{ loop.index }}</div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Surah Navigation -->
    <div class="surah-navigation">
        <button class="nav-btn prev-surah" {% if surah.number == 1 %}disabled{% endif %}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Previous Surah
        </button>
        <button class="nav-btn next-surah" {% if surah.number == 114 %}disabled{% endif %}>
            Next Surah
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </button>
    </div>
</div>

{% include 'partials/feedback_modal.html' %}
<!-- Add this to both surah.html and ayah.html before the closing </body> tag -->
<div id="autoplayModal" class="autoplay-modal hidden">
    <div class="autoplay-content">
      <h3>Next Recommendation</h3>
      <p>Playing next in <span id="countdown">5</span> seconds</p>
      <div class="countdown-circle">
        <svg class="countdown-svg" viewBox="0 0 36 36">
          <path class="countdown-circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="countdown-circle-fill" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
      </div>
      <button id="cancelAutoplay" class="cancel-btn">Cancel</button>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/surah.js') }}"></script>
<script src="{{ url_for('static', filename='js/Base.js') }}"></script>
<script src="{{ url_for('static', filename='js/feedback.js') }}"></script>
<script>
    // Set content type and ID for feedback system
    document.body.dataset.contentType = 'surah';
    document.body.dataset.contentId = '{{ surah.number }}';
    document.body.dataset.emotion = '{{ request.args.get("emotion", "neutral") }}';
</script>
{% endblock %}